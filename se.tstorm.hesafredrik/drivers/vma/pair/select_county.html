<script type="application/javascript">
  var selectedCounty = null;

  Homey.emit("get_counties", { }).then(function (result) {
    var select = document.getElementById("select-county");

    // Add default placeholder option
    var placeholder = document.createElement("option");
    placeholder.textContent = Homey.__("pair.select_county.placeholder");
    placeholder.value = "";
    placeholder.disabled = true;
    placeholder.selected = true;
    select.appendChild(placeholder);

    for (var i = 0; i < result.length; i++) {
      var opt = result[i];
      var el = document.createElement("option");
      el.textContent = opt.name;
      el.value = opt.id;

      // Disable separator option
      if (opt.id === 'separator') {
        el.disabled = true;
      }

      select.appendChild(el);
    }

    // Store selected county when user changes selection
    select.addEventListener("change", function (event) {
      selectedCounty = event.target.value;
      Homey.emit("set_county", { id: selectedCounty });
    });
  });

  // Handle Next button - ensure set_county is called
  Homey.on("showView", function(viewId) {
    if (viewId === "list_devices" && selectedCounty) {
      // Ensure set_county is called before navigating
      Homey.emit("set_county", { id: selectedCounty });
    }
  });
</script>

<div class="homey-form-group">
    <label class="homey-form-label" for="select-county" id="county-label"></label>
    <select class="homey-form-select" name="select-county" id="select-county">
    </select>
</div>

<script type="application/javascript">
  // Set translated label text
  document.getElementById("county-label").textContent = Homey.__("pair.select_county.title");
</script>